'use strict';window.Calendar_Calendar_Js=new class extends Calendar_Js{constructor(a,b){super(a,b)}setCalendarModuleOptions(){let a=this;return{select:function(c,d){a.selectDays(c,d),a.getCalendarView().fullCalendar('unselect')},eventClick:function(c,d){d.preventDefault();var g=new URL($(this)[0].href),h=jQuery.progressIndicator({blockInfo:{enabled:!0}}),j='index.php?module=Calendar&view=ActivityStateModal&record='+g.searchParams.get('record');app.showModalWindow({url:j,cb:function(){h.progressIndicator({mode:'hide'})}})}}}getValuesFromSelect2(a,b,c){if(a.hasClass('select2-hidden-accessible'))for(var d=a.select2('data'),f=0;f<d.length;f++)c?b.push(d[f].text):b.push(d[f].id);return b}getDefaultParams(){let a=super.getDefaultParams(),b=app.moduleCacheGet('calendar-groups')||[],c=[];$('.calendarFilters .filterField').each(function(){let g,h,f=$(this);'checkbox'==f.attr('type')?(g=f.val(),h=f.prop('checked')?1:0):(g=f.attr('name'),h=f.val()),c.push({name:g,value:h})});let d={time:app.getMainParams('showType'),filters:c};return b.length&&(d.user=a.user.concat(b),d.emptyFilters=!1),d=Object.assign(a,d),d}selectDays(a,b){var c=this,d=app.getMainParams('startHour'),f=app.getMainParams('endHour');!1==b.hasTime()&&b.add(-1,'days'),a=a.format(),b=b.format();var g=c.getCalendarView().fullCalendar('getView');''==d&&(d='00'),''==f&&(f='00'),this.getCalendarCreateView().done(function(h){if(!(0>=h.length)){if('agendaDay'!=g.name&&'agendaWeek'!=g.name&&(a=a+'T'+d+':00',b=b+'T'+d+':00',a==b)){let r=h.find('[name="activitytype"]').val(),s=JSON.parse(h.find('[name="defaultOtherEventDuration"]').val()),t=0;for(let u in s)if(s[u].activitytype===r){t=parseInt(s[u].duration);break}b=moment(b).add(t,'minutes').toISOString()}var j=h.find('[name="date_start"]').data('dateFormat').toUpperCase(),k=h.find('[name="time_start"]').data('format');if(24==k)var l='HH:mm';else l='hh:mm A';var m=moment(a).format(j),n=moment(a).format(l),o=moment(b).format(j),p=moment(b).format(l);h.find('[name="date_start"]').val(m),h.find('[name="due_date"]').val(o),h.find('[name="time_start"]').val(n),h.find('[name="time_end"]').val(p);var q=new Vtiger_Header_Js;q.handleQuickCreateData(h,{callbackFunction:function(r){c.addCalendarEvent(r.result)}})}})}isNewEventToDisplay(a){if(super.isNewEventToDisplay(a)){let c=$.inArray(a.activitystatus.value,['PLL_POSTPONED','PLL_CANCELLED','PLL_COMPLETED']);var b=$('.fc-toolbar .js-switch--label-on').last().hasClass('active');return!0===b&&0<=c||!0!=b&&-1==c?!1:!0}return!1}getCalendarCreateView(){var a=this,b=jQuery.Deferred();if(!1!==this.calendarCreateView)return b.resolve(this.calendarCreateView.clone(!0,!0)),b.promise();var c=jQuery.progressIndicator({blockInfo:{enabled:!0}});return this.loadCalendarCreateView().done(function(d){c.progressIndicator({mode:'hide'}),a.calendarCreateView=d,b.resolve(d.clone(!0,!0))}).fail(function(d){c.progressIndicator({mode:'hide'}),console.error(d)}),b.promise()}loadCalendarCreateView(){var a=jQuery.Deferred(),b=app.getModuleName(),d=Vtiger_Header_Js.getInstance();return d.getQuickCreateForm('index.php?module='+b+'&view=QuickCreateAjax',b).done(function(f){a.resolve(jQuery(f))}).fail(function(){a.reject()}),a.promise()}switchTpl(a,b,c){return`<div class="btn-group btn-group-toggle js-switch c-calendar-switch" data-toggle="buttons">
					<label class="btn btn-outline-primary c-calendar-switch__button js-switch--label-on ${c?'':'active'}">
						<input type="radio" name="options" data-on-text="${a}" autocomplete="off" ${c?'':'checked'}>
						${a}
					</label>
					<label class="btn btn-outline-primary c-calendar-switch__button ${c?'active':''}">
						<input type="radio" name="options" data-off-text="${b}" autocomplete="off" ${c?'checked':''}>
						${b}
					</label>
				</div>`}registerSwitchEvents(){const a=this.getCalendarView();let b,c,d=$(`<div class="js-calendar-switch-container"></div>`).insertAfter(a.find('.fc-center'));b='current'==app.getMainParams('showType')&&'history'!=app.moduleCacheGet('defaultShowType')?!1:!0,$(this.switchTpl(app.vtranslate('JS_TO_REALIZE'),app.vtranslate('JS_HISTORY'),b)).prependTo(d).on('change','input',f=>{const g=$(f.currentTarget);'undefined'==typeof g.data('on-text')?'undefined'!=typeof g.data('off-text')&&(app.setMainParams('showType','history'),app.moduleCacheSet('defaultShowType','history')):(app.setMainParams('showType','current'),app.moduleCacheSet('defaultShowType','current')),this.loadCalendarData()}),c='workDays'===app.getMainParams('switchingDays')&&'all'!==app.moduleCacheGet('defaultSwitchingDays')?!1:!0,!1!==app.getMainParams('hiddenDays',!0)&&$(this.switchTpl(app.vtranslate('JS_WORK_DAYS'),app.vtranslate('JS_ALL'),c)).prependTo(d).on('change','input',f=>{const g=$(f.currentTarget);let h=[];'undefined'==typeof g.data('on-text')?'undefined'!=typeof g.data('off-text')&&(app.setMainParams('switchingDays','all'),app.moduleCacheSet('defaultSwitchingDays','all')):(app.setMainParams('switchingDays','workDays'),app.moduleCacheSet('defaultSwitchingDays','workDays'),h=app.getMainParams('hiddenDays',!0)),a.fullCalendar('option','hiddenDays',h),this.registerSwitchEvents(),this.loadCalendarData()})}registerCacheSettings(){var a=this,b=a.getCalendarView();'all'==app.moduleCacheGet('defaultSwitchingDays')?app.setMainParams('switchingDays','all'):app.setMainParams('switchingDays','workDays'),'history'==app.moduleCacheGet('defaultShowType')?app.setMainParams('showType','history'):app.setMainParams('showType','current'),$('.siteBarRight .filterField').each(function(){var g=$(this).attr('id'),h=app.moduleCacheGet(g),j=$('#'+g);0<j.length&&null!=h&&'checkbox'==j.attr('type')&&j.prop('checked',h)}),b.find('.fc-toolbar .fc-button').on('click',function(f){let g,h=$(f.currentTarget);g=b.fullCalendar('getView'),h.hasClass('fc-'+g.name+'-button')?app.moduleCacheSet('defaultView',g.name):(h.hasClass('fc-prev-button')||h.hasClass('fc-next-button')||h.hasClass('fc-today-button'))&&(app.moduleCacheSet('start',g.start.format()),app.moduleCacheSet('end',g.end.format()))});var c=app.moduleCacheKeys();if(0<c.length){var d=$('#moduleCacheAlert');$('.bodyContents').on('Vtiger.Widget.Load.undefined',function(){d.removeClass('d-none')}),d.find('.cacheClear').on('click',function(){app.moduleCacheClear(),d.addClass('d-none'),location.reload()})}}registerEvents(){super.registerEvents(),this.registerCacheSettings(),this.registerSwitchEvents()}};